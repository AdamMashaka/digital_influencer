{% extends 'dashboards/backoffice/base.html' %} 
{% load static %} 

{% block toolbar %}
  <div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
      <!--begin::Toolbar container-->
      <div
        id="kt_app_toolbar_container"
        class="app-container container-fluid d-flex flex-stack"
      >
        <!--begin::Page title-->
        <div
          class="page-title d-flex flex-column justify-content-center flex-wrap me-3"
        >
          <!--begin::Title-->
          <h1
            class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0"
          >
          Generate Report
          </h1>
          <!--end::Title-->

          <!--begin::Breadcrumb-->
          <ul
            class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1"
          >
            <!--begin::Item-->
            <li class="breadcrumb-item text-muted">
              <a href="{% url 'index' %}" class="text-muted text-hover-primary">
                Home
              </a>
            </li>
            <!--end::Item-->
            <!--begin::Item-->
            <li class="breadcrumb-item">
              <span class="bullet bg-gray-400 w-5px h-2px"></span>
            </li>
            <!--end::Item-->

            <!--begin::Item-->
            <li class="breadcrumb-item text-muted">report</li>
            <!--end::Item-->
          </ul>
          <!--end::Breadcrumb-->
        </div>
        <!--end::Page title-->
        <!--begin::Actions-->
        <div class="d-flex align-items-center gap-2 gap-lg-3">
          <!--begin::Filter menu-->
          <div class="m-0">
            <!--begin::Menu toggle-->
            <a
              href="#"
              class="btn btn-sm btn-flex bg-body btn-color-gray-700 btn-active-color-primary fw-bold"
              data-kt-menu-trigger="click"
              data-kt-menu-placement="bottom-end"
            >
              <i class="ki-duotone ki-filter fs-6 text-muted me-1"
                ><span class="path1"></span><span class="path2"></span
              ></i>
              Filter
            </a>
            <!--end::Menu toggle-->

            <!--begin::Menu 1-->
            <div
              class="menu menu-sub menu-sub-dropdown w-250px w-md-300px"
              data-kt-menu="true"
              id="kt_menu_644b6618c3b2f"
            >
              <!--begin::Header-->
              <div class="px-7 py-5">
                <div class="fs-5 text-dark fw-bold">Filter Options</div>
              </div>
              <!--end::Header-->

              <!--begin::Menu separator-->
              <div class="separator border-gray-200"></div>
              <!--end::Menu separator-->

              <!--begin::Form-->
              <div class="px-7 py-5">
                <!--begin::Input group-->
                <div class="mb-10">
                  <!--begin::Label-->
                  <label class="form-label fw-semibold">Status:</label>
                  <!--end::Label-->

                  <!--begin::Input-->
                  <div>
                    <select
                      class="form-select form-select-solid"
                      data-kt-select2="true"
                      data-placeholder="Select option"
                      data-dropdown-parent="#kt_menu_644b6618c3b2f"
                      data-allow-clear="true"
                    >
                      <option></option>
                      <option value="1">Seminar</option>
                      <option value="2">Holiday</option>
                      <option value="2">Event</option>
                    </select>
                  </div>
                  <!--end::Input-->
                </div>
                <!--end::Input group-->

                <!--begin::Input group-->
                <div class="mb-10">
                  <!--begin::Label-->
                  <label class="form-label fw-semibold">Event type:</label>
                  <!--end::Label-->

                  <!--begin::Options-->
                  <div class="d-flex">
                    <!--begin::Options-->
                    <label
                      class="form-check form-check-sm form-check-custom form-check-solid me-5"
                    >
                      <input
                        class="form-check-input"
                        type="checkbox"
                        value="1"
                      />
                      <span class="form-check-label"> All </span>
                    </label>
                    <!--end::Options-->

                    <!--begin::Options-->
                    <label
                      class="form-check form-check-sm form-check-custom form-check-solid"
                    >
                      <input
                        class="form-check-input"
                        type="checkbox"
                        value="2"
                        checked="checked"
                      />
                      <span class="form-check-label"> This Year </span>
                    </label>
                    <!--end::Options-->
                  </div>
                  <!--end::Options-->
                </div>
                <!--end::Input group-->

                <!--begin::Input group-->
                <div class="mb-10">
                  <!--begin::Label-->
                  <label class="form-label fw-semibold">Notifications:</label>
                  <!--end::Label-->

                  <!--begin::Switch-->
                  <div
                    class="form-check form-switch form-switch-sm form-check-custom form-check-solid"
                  >
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value=""
                      name="notifications"
                      checked
                    />
                    <label class="form-check-label"> Enabled </label>
                  </div>
                  <!--end::Switch-->
                </div>
                <!--end::Input group-->

                <!--begin::Actions-->
                <div class="d-flex justify-content-end">
                  <button
                    type="reset"
                    class="btn btn-sm btn-light btn-active-light-primary me-2"
                    data-kt-menu-dismiss="true"
                  >
                    Reset
                  </button>

                  <button
                    type="submit"
                    class="btn btn-sm btn-primary"
                    data-kt-menu-dismiss="true"
                  >
                    Apply
                  </button>
                </div>
              </div>
            </div>
          </div>
          <a
            href="#"
            class="btn btn-sm fw-bold btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#kt_modal_create_app"
          >
            Create
          </a>
        </div>
      </div>
    </div>
{% endblock toolbar %}

{% block content%}  

<!--begin::Login sessions-->

<div class="row g-5 g-xl-8">
  {% if not user.is_superuser %}
  <div class="col-xl-3">
      <a href="#" class="card bg-body hoverable card-xl-stretch mb-xl-8">
          <div class="card-body">
              <i class="ki-duotone ki-chart-simple text-primary fs-2x ms-n1"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span></i>   
              <div class="text-gray-900 fw-bold fs-2 mb-2 mt-5">{{ total_revenue }}</div>
              <div class="fw-semibold text-gray-400">Atendee event</div>  
          </div>
      </a>
  </div>
  

  <div class="col-xl-3">
      <a href="#" class="card bg-dark hoverable card-xl-stretch mb-xl-8">
          <div class="card-body">
              <i class="ki-duotone ki-cheque text-gray-100 fs-2x ms-n1"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span></i>
              <div class="text-gray-100 fw-bold fs-2 mb-2 mt-5">{{ postponed_events_count }}</div>
              <div class="fw-semibold text-gray-100">Registered events</div>
          </div>
      </a>
  </div>


  <div class="col-xl-3">
      <a href="#" class="card bg-info hoverable card-xl-stretch mb-5 mb-xl-8">
          <div class="card-body">
              <i class="ki-duotone ki-chart-pie-simple text-white fs-2x ms-n1"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span><span class="path6"></span><span class="path7"></span></i>
              <div class="text-gray-100 fw-bold fs-2 mb-2 mt-5">{{ postponed_events_count }}</div>
              <div class="fw-semibold text-gray-100">Certificate generate</div>
          </div>
      </a>
  </div>
{% endif %}

<div class="card">
    <div class="card-header">
        <div class="card-title">
            <h3>Certificate Issuance</h3>
        </div>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <!--begin::Table-->
            <table class="table align-middle table-row-bordered table-row-solid gy-4" id="kt_certificate_issuance_table">
                <!--begin::Thead-->
                <thead class="border-gray-200 fs-5 fw-semibold bg-lighten">
                    <tr>
                        <th class="w-150px ps-9">Status</th>
                        <th class="px-0 min-w-250px">Organizer</th>
                        <th class="min-w-150px">Event Name</th>
                        <th class="min-w-150px">Date</th>
                        <th class="pe-0 min-w-150px">Download</th>
                        <th class="min-w-50px">Generate</th>
                    </tr>
                </thead>
                <!--end::Thead-->

                <!--begin::Tbody-->
                <tbody class="fw-6 fw-semibold text-gray-600">
                    {% for event in events %}
                    <tr>
                        <td class="ps-9">
                            <span class="badge badge-light-success fs-7 fw-bold">Certificate</span>
                        </td>
                        <td class="ps-0">
                            <a href="#" class="text-hover-primary text-gray-600">{{ event.organizer }}</a>
                        </td>
                        <td>{{ event.title }}</td>
                        <td>{{ event.date }}</td>
                        <td data-bs-target="certificate">{{ event.certificate_id }}</td>
                        <td class="ps-5">
                            <button type="button" class="btn" onclick="openModal('{{ event.id }}')">Generate</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<!--end::Certificate issuance-->

<!-- Modal for certificate generation -->
<div id="certificateModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Certificate for {{ event.name }}</h2>
        <p><strong>Organizer:</strong> {{ event.organizer }}</p>
        <p><strong>Date:</strong> {{ event.date }}</p>
        <p><strong>Location:</strong> {{ event.location }}</p>
        <p><strong>Description:</strong> {{ event.description }}</p>
        <p><strong>Admin:</strong> {{ event.admin }}</p>
        <img src="{{ event.sponsor_image.url }}" alt="Sponsor Image" style="width: 100px; height: auto;">
        <img src="{{ event.logo.url }}" alt="Event Logo" style="width: 100px; height: auto;">
        <p><strong>Certificate ID:</strong> {{ event.certificate_id }}</p>
    </div>
</div>


<script>
    function openModal(eventId) {
        var modal = document.getElementById("certificateModal");
        modal.style.display = "block";
    }

    function closeModal() {
        var modal = document.getElementById("certificateModal");
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        var modal = document.getElementById("certificateModal");
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>

  <!--end::Content wrapper-->
  {% endblock content%}
</div>